# Plan: Mandatory Multi-Dev Migration (v0.9.0)

**Created:** Feb 2, 2026  
**Status:** ðŸ“‹ PLANNED  
**Planner:** @Planner (AI Agent)  
**Estimated Time:** 2-3 hours  
**Target Release:** v0.9.0 (Breaking Change)

---

## Context

**Problem:** Supporting both single-dev and multi-dev patterns adds:
- Code complexity (if/else branching everywhere)
- Mental overhead (which file? PENDING_REVIEW vs reviews/PENDING_<user>.md?)
- AI confusion (agents don't know which pattern to use)
- Testing burden (2x scenarios to maintain)
- Documentation duplication

**Solution:** Make multi-dev pattern MANDATORY for all projects.

**Justification:**
- Early adoption (< 10 users) = low breaking change cost
- Multi-dev pattern works for solo developers (just one username)
- Simpler system overall (one pattern, less code)
- Future-proof (scales to teams naturally)
- AI agents are "developers" too (human + AI = multi-dev by definition)

**Breaking Change:** Yes - Requires existing users to migrate.

---

## Architecture Decision

**Remove entirely:**
- `.aiknowsys/PENDING_REVIEW.md` (old single-dev pattern)
- `.aiknowsys/CURRENT_PLAN.md` as manual edit file (becomes generated index)
- All single-dev detection logic in agents

**Keep as generated:**
- `.aiknowsys/CURRENT_PLAN.md` (team index, auto-generated by sync-plans)

**Make mandatory:**
- `.aiknowsys/plans/` directory (created by init)
- `.aiknowsys/plans/active-<username>.md` (per-developer plan pointer)
- `.aiknowsys/reviews/` directory (gitignored)
- `.aiknowsys/reviews/PENDING_<username>.md` (per-developer review)

**User experience:**
- Solo dev sees: `plans/active-arno.md`, `reviews/PENDING_arno.md`
- Team sees: `plans/active-alice.md`, `plans/active-bob.md`, etc.
- No conceptual difference - same workflow, just scoped by username

---

## Migration Plan

### Phase 1: Migration Script (30 min)

**Create:** `lib/commands/migrate-to-multidev.js`

**What it does:**
1. Detect if already migrated (plans/ exists) â†’ skip
2. Get git username, normalize
3. Create `.aiknowsys/plans/` directory
4. Create `.aiknowsys/plans/README.md` (explain workflow)
5. Create `.aiknowsys/reviews/` directory
6. Create `.aiknowsys/reviews/README.md` (explain workflow)
7. Migrate `CURRENT_PLAN.md` â†’ `plans/active-<username>.md`
8. Move `PENDING_REVIEW.md` â†’ `reviews/PENDING_<username>.md` (if exists)
9. Regenerate CURRENT_PLAN.md as team index (via sync-plans)
10. Update `.gitignore` (reviews/, personal/)
11. Show success message with next steps

**Invocation:**
- Automatically run by `npx aiknowsys init` (new projects)
- Manually run by `npx aiknowsys migrate-to-multidev` (existing projects)
- Show deprecation warning in other commands if not migrated

**Tests:**
- Idempotent (safe to run multiple times)
- Handles missing files gracefully
- Preserves existing plans
- Creates correct directory structure

---

### Phase 2: Update Init Command (20 min)

**File:** `lib/commands/init.js`

**Changes:**
1. Always create `plans/` and `reviews/` directories
2. Create initial `plans/active-<username>.md` pointing to welcome plan
3. Create `CURRENT_PLAN.md` as team index (not manual edit file)
4. Update `.gitignore` template to include reviews/ and personal/
5. Show multi-dev workflow in welcome message

**Remove:**
- Single-dev CURRENT_PLAN.md template
- Conditional logic for single vs multi-dev

---

### Phase 3: Update Agents (30 min)

**Files:**
- `.github/agents/developer.agent.md`
- `.github/agents/architect.agent.md`

**Changes:**
1. Remove all single-dev detection logic
2. Always use `plans/active-<username>.md`
3. Always use `reviews/PENDING_<username>.md`
4. Update session file markers to reference multi-dev paths only
5. Simplify instructions (no if/else branching)

**Before:**
```markdown
- Check if `.aiknowsys/plans/` exists
- If yes: Multi-dev mode
- If no: Single-dev mode (use PENDING_REVIEW.md)
```

**After:**
```markdown
- Always use `plans/active-<username>.md`
- Always use `reviews/PENDING_<username>.md`
```

---

### Phase 4: Update Commands (30 min)

**sync-plans command:**
- No changes needed (already assumes multi-dev)

**learn command:**
- Already supports personal/<username>/ (no changes)

**share-pattern command:**
- Already supports multi-dev (no changes)

**Other commands:**
- Search for any CURRENT_PLAN.md references
- Update to use plans/active-<username>.md or team index appropriately

---

### Phase 5: Documentation Updates (30 min)

**Files to update:**
1. **CODEBASE_ESSENTIALS.md**
   - Remove single-dev pattern documentation
   - Update "Plan Management Pattern" section
   - Show only multi-dev workflow
   - Update file structure diagram

2. **AGENTS.md**
   - Update review workflow (only multi-dev paths)
   - Remove single-dev examples
   - Update session file examples

3. **SETUP_GUIDE.md**
   - Update initial setup instructions
   - Add migration section for v0.8.x users

4. **README.md**
   - Update workflow examples
   - Show team collaboration as primary use case

5. **CONTRIBUTING.md**
   - Update developer setup
   - Show multi-dev workflow for contributors

6. **Create MIGRATION_GUIDE_v0.9.0.md**
   - Step-by-step for existing users
   - "What changed and why"
   - Run migration script
   - Verify with sync-plans

---

### Phase 6: Testing & Validation (30 min)

**Test scenarios:**
1. âœ… Fresh init creates multi-dev structure
2. âœ… Migration script converts existing project
3. âœ… Migration script is idempotent
4. âœ… Agents use correct file paths
5. âœ… sync-plans generates team index correctly
6. âœ… All existing tests still pass
7. âœ… No references to old single-dev pattern

**Manual E2E:**
1. Clone fresh repo
2. Run `npx aiknowsys init`
3. Verify plans/ and reviews/ created
4. Verify CURRENT_PLAN.md is team index
5. Create plan, verify workflow works
6. Test architect review â†’ correct review file location

---

### Phase 7: Release Preparation (20 min)

**Version bump:** v0.8.0 â†’ v0.9.0 (minor bump, breaking change)

**Changelog updates:**
```markdown
## v0.9.0 - Mandatory Multi-Dev Migration (Feb X, 2026)

### ðŸš¨ BREAKING CHANGES

**Multi-dev pattern is now mandatory for all projects.**

**Why:** Simplifies codebase, removes dual-pattern complexity, future-proof for teams.

**Migration required:** Run `npx aiknowsys migrate-to-multidev`

**What changed:**
- `.aiknowsys/CURRENT_PLAN.md` is now auto-generated (team index)
- Plan pointers: Use `plans/active-<username>.md` (not CURRENT_PLAN.md)
- Reviews: Use `reviews/PENDING_<username>.md` (not PENDING_REVIEW.md)
- Solo developers: Same workflow, just scoped by username

**Migration guide:** See MIGRATION_GUIDE_v0.9.0.md

### Added
- `migrate-to-multidev` command for automatic migration
- Deprecation warnings for unmigrated projects

### Removed
- Single-dev pattern support
- PENDING_REVIEW.md (replaced by reviews/PENDING_<username>.md)
- Dual-pattern detection logic in agents
```

**Release notes:**
- Explain rationale (simplicity, AI collaboration)
- Highlight migration script
- Emphasize works for solo devs too
- Show before/after file structure

---

## Rollout Strategy

**Week 1: Preparation**
- [ ] Complete implementation (Phases 1-6)
- [ ] Test thoroughly
- [ ] Write migration guide
- [ ] Update all documentation

**Week 2: Soft Launch**
- [ ] Release v0.9.0-beta.1
- [ ] Contact early adopters (if any)
- [ ] Assist with migration
- [ ] Collect feedback

**Week 3: Release**
- [ ] Address beta feedback
- [ ] Release v0.9.0 stable
- [ ] Publish announcement
- [ ] Update examples repo

---

## Risks & Mitigations

**Risk 1: Breaking existing workflows**
- **Mitigation:** Auto-migration script, clear docs, deprecation warnings

**Risk 2: Users don't understand multi-dev**
- **Mitigation:** Explain "AI is a developer" in docs, show solo dev examples

**Risk 3: Migration script bugs**
- **Mitigation:** Idempotent design, dry-run mode, comprehensive tests

**Risk 4: Adoption resistance**
- **Mitigation:** Early adoption = low impact, explain benefits clearly

---

## Success Metrics

- [ ] All existing projects migrate successfully
- [ ] Zero issues with single â†’ multi-dev conversion
- [ ] Reduced agent mode code by ~30% (remove dual-pattern logic)
- [ ] Documentation clarity improves (one pattern to explain)
- [ ] No support requests about "which file do I use?"

---

## Dependencies

**Blocks:**
- None (can be done independently)

**Blocked by:**
- Phase 3 (pre-commit hooks) completion (for testing integration)

**Related:**
- Phase 2 (multi-dev pattern) - uses this work
- Phase 3 (automation) - benefits from single pattern

---

## Next Steps

1. **Review this plan** - Get approval from maintainer
2. **Schedule implementation** - After Phase 3 complete
3. **Create tracking issue** - GitHub issue for v0.9.0
4. **Update roadmap** - Mark as planned breaking change

---

*Plan ready for review. Estimated 2-3 hours total implementation time.*
